<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tazerwa Admin Panel</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Gradient Header */
    header {
      background: linear-gradient(90deg, #ff6b6b, #f06595, #845ef7);
      color: white;
      padding: 20px;
      text-align: center;
      position: relative;
    }
    header img {
      height: 60px;
      display: block;
      margin: 0 auto 10px auto;
    }
    header h1 {
      font-size: 1.5rem;
      margin: 0;
      font-weight: 600;
    }
    header .home-btn {
      position: absolute;
      left: 20px;
      top: 20px;
      background: white;
      color: #333;
      padding: 6px 12px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 500;
      transition: 0.3s;
    }
    header .home-btn:hover {
      background: #f1f1f1;
    }

    /* Filters */
    .filters {
      max-width: 1200px;
      margin: 20px auto;
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .filters input, .filters select {
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 14px;
    }

    .add-btn {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: 0.3s;
    }
    .add-btn:hover {
      background: #218838;
    }

    /* Products Grid (your CSS already handles most) */
    .product-actions button {
      flex: 1;
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
    }
    .edit-btn {
      background: #28a745;
      color: white;
    }
    .edit-btn:hover {
      background: #218838;
    }
    .delete-btn {
      background: #dc3545;
      color: white;
    }
    .delete-btn:hover {
      background: #b02a37;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 15px;
      margin-top: 40px;
      background: #f8f9fa;
      border-top: 1px solid #e9ecef;
      font-size: 14px;
      color: #6c757d;
    }

    /* Modal (Edit Form) */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 400px;
      max-width: 90%;
    }
    .modal-content input, .modal-content select {
      width: 100%;
      margin-bottom: 10px;
      padding: 8px 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
    }
    .modal-content .save-btn {
      background: #28a745;
      color: white;
      border: none;
      padding: 10px;
      width: 100%;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }
    .modal-content .close-btn {
      margin-top: 10px;
      background: #6c757d;
      color: white;
      border: none;
      padding: 8px;
      width: 100%;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <a href="index.html" class="home-btn">Home</a>
    <img src="img/logo.png" alt="Tazerwa Logo">
    <h1>Admin Panel</h1>
  </header>

  <!-- Filters -->
  <div class="filters">
    <input type="text" id="searchInput" placeholder="Search products...">
    <select id="categorySelect">
      <option value="">All Categories</option>
      <option value="Food">Food</option>
      <option value="Drinks">Drinks</option>
      <option value="Beauty">Beauty</option>
      <option value="Gifts">Gifts</option>
      <option value="Baby Stuff">Baby Stuff</option>
      <option value="Hot deals">Hot deals</option>
    </select>
    <select id="subcategorySelect">
      <option value="">All Subcategories</option>
    </select>
  </div>

  <!-- Add Product -->
  <button class="add-btn" onclick="document.getElementById('newProductModal').style.display='flex'">
    + Add New Product
  </button>

  <!-- Products Section -->
  <section class="products-section">
    <div id="productsContainer" class="products-grid"></div>
  </section>

  <!-- Footer -->
  <footer>
    Â© 2025 Tazerwa. All rights reserved.
  </footer>

  <!-- Edit Modal -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <h3>Edit Product</h3>
      <input type="hidden" id="editId">
      <input type="text" id="editName" placeholder="Product Name">
      <input type="number" id="editPrice" placeholder="Price">
      <select id="editCategory"></select>
      <select id="editSubcategory"></select>
      <button class="save-btn" onclick="saveProduct()">Save</button>
      <button class="close-btn" onclick="closeEditModal()">Cancel</button>
    </div>
  </div>

  <!-- Add New Product Modal -->
  <div class="modal" id="newProductModal">
    <div class="modal-content">
      <h3>Add New Product</h3>
      <form id="newProductForm" onsubmit="event.preventDefault(); addNewProduct();">
        <input type="text" id="newName" placeholder="Product Name" required>
        <input type="number" id="newPrice" placeholder="Price" required>
        <select id="newCategory" required></select>
        <select id="newSubcategory"></select>
        <input type="file" id="newImage" accept="image/*">
        <button class="save-btn" type="submit">Add Product</button>
      </form>
      <button class="close-btn" onclick="document.getElementById('newProductModal').style.display='none'">Cancel</button>
    </div>
  </div>

  <script>
    // ===============================
// Admin Panel JS
// ===============================

// Backend API endpoint
const API_URL = "http://localhost/Tazerwa/api.php";

// Global products array
let allProducts = [];

// Load all products from backend
async function loadProducts() {
  try {
    const res = await fetch(API_URL);
    allProducts = await res.json();
    displayProducts(allProducts);
  } catch (err) {
    console.error("Error loading products:", err);
  }
}

// Display products in grid
function displayProducts(products) {
  const container = document.getElementById("productsContainer");
  if (!container) return;

  container.innerHTML = "";

  if (products.length === 0) {
    container.innerHTML = "<p>No products found.</p>";
    return;
  }

  products.forEach(p => {
    const card = document.createElement("div");
    card.className = "product-card";

    card.innerHTML = `
      <div class="product-image">
        <img src="${p.image}" alt="${p.name}">
      </div>
      <div class="product-info">
        <h4 class="product-name">${p.name}</h4>
        <p class="product-price"><strong>${p.price} RWF</strong></p>
        <div class="product-actions">
          <button class="edit-btn" onclick="openEditModal(${p.id})">Edit</button>
          <button class="delete-btn" onclick="deleteProduct(${p.id})">Delete</button>
        </div>
      </div>
    `;

    container.appendChild(card);
  });
}

// ===============================
// Filtering & Searching
// ===============================
function filterProducts() {
  const search = document.getElementById("searchInput").value.toLowerCase();
  const category = document.getElementById("categorySelect").value;

  let filtered = allProducts.filter(p =>
    p.name.toLowerCase().includes(search) &&
    (category === "" || p.category === category)
  );

  displayProducts(filtered);
}

// ===============================
// Product Actions
// ===============================
function openEditModal(id) {
  const product = allProducts.find(p => p.id === id);
  if (!product) return;

  document.getElementById("editId").value = product.id;
  document.getElementById("editName").value = product.name;
  document.getElementById("editPrice").value = product.price;
  document.getElementById("editCategory").value = product.category;
  document.getElementById("editSubcategory").value = product.subcategory;

  document.getElementById("editModal").style.display = "block";
}

function closeEditModal() {
  document.getElementById("editModal").style.display = "none";
}

async function saveProduct() {
  const id = document.getElementById("editId").value;
  const name = document.getElementById("editName").value;
  const price = document.getElementById("editPrice").value;
  const category = document.getElementById("editCategory").value;
  const subcategory = document.getElementById("editSubcategory").value;

  const updatedProduct = { id, name, price, category, subcategory };

  try {
    await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action: "update", product: updatedProduct })
    });

    closeEditModal();
    loadProducts();
  } catch (err) {
    console.error("Error saving product:", err);
  }
}

async function deleteProduct(id) {
  if (!confirm("Are you sure you want to delete this product?")) return;

  try {
    await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action: "delete", id })
    });

    loadProducts();
  } catch (err) {
    console.error("Error deleting product:", err);
  }
}

// ===============================
// Add New Product
// ===============================
async function addNewProduct() {
  const name = document.getElementById("newName").value;
  const price = document.getElementById("newPrice").value;
  const category = document.getElementById("newCategory").value;
  const subcategory = document.getElementById("newSubcategory").value;
  const image = document.getElementById("newImage").files[0];

  if (!name || !price || !category) {
    alert("Please fill all required fields!");
    return;
  }

  const formData = new FormData();
  formData.append("action", "add");
  formData.append("name", name);
  formData.append("price", price);
  formData.append("category", category);
  formData.append("subcategory", subcategory);
  if (image) formData.append("image", image);

  try {
    await fetch(API_URL, {
      method: "POST",
      body: formData
    });

    loadProducts();
    document.getElementById("newProductForm").reset();
  } catch (err) {
    console.error("Error adding product:", err);
  }
}

// ===============================
// Event Listeners
// ===============================
document.getElementById("searchInput").addEventListener("input", filterProducts);
document.getElementById("categorySelect").addEventListener("change", filterProducts);

window.onload = loadProducts;

  </script>
</body>
</html>
