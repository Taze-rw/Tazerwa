<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tazerwa — Admin: Products</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* keep your previous CSS unchanged */
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Roboto',sans-serif;background:#fafafa;overflow-x:hidden;line-height:1.6;color:#222}
    .top-nav{display:flex;align-items:center;justify-content:space-between;padding:18px 24px;background:linear-gradient(135deg,#6e7969,#20c997);color:white}
    .logo{display:flex;align-items:center;gap:12px}
    .logo img{width:84px}
    .top-nav a.home-btn{background:transparent;color:white;border:2px solid rgba(255,255,255,0.12);padding:8px 14px;border-radius:20px;text-decoration:none}
    .container{max-width:1200px;margin:28px auto;padding:0 20px}
    h1{font-family:'Poppins',sans-serif;margin-bottom:6px}
    p.lead{color:#556; margin-bottom:18px}
    .filter-row{display:flex;gap:12px;align-items:center;margin-bottom:18px;flex-wrap:wrap}
    select.form-control,input.form-control{padding:12px;border-radius:10px;border:1px solid #e9ecef;min-width:180px}
    .add-toggle{display:flex;justify-content:center;margin:18px 0}
    .plus-btn{width:44px;height:44px;border-radius:50%;background:white;border:none;box-shadow:0 4px 12px rgba(0,0,0,0.08);display:inline-flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer}
    .add-form{background:white;padding:16px;border-radius:12px;box-shadow:0 4px 18px rgba(0,0,0,0.06);margin-bottom:22px;display:none}
    .form-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .form-row{display:flex;flex-direction:column;gap:6px}
    label{font-size:13px;color:#444}
    .btn{padding:10px 16px;border-radius:10px;border:none;cursor:pointer}
    .btn-primary{background:linear-gradient(45deg,#6e7969,#20c997);color:white}
    .btn-danger{background:#ff6b6b;color:white}
    .btn-outline{background:transparent;border:1px solid #e9ecef}
    .products-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:20px}
    .product-card{background:white;border-radius:12px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.08);transition:all .3s;height:320px;display:flex;flex-direction:column;border:1px solid #f1f3f4}
    .product-image{height:160px;background:#f8f9fa;overflow:hidden}
    .product-image img{width:100%;height:100%;object-fit:cover}
    .product-info{padding:14px;flex:1;display:flex;flex-direction:column;justify-content:space-between}
    .product-name{font-family:'Poppins',sans-serif;font-size:14px;color:#333;margin-bottom:6px;font-weight:600}
    .product-price{font-size:15px;color:#6e7969;font-weight:700}
    .product-actions{display:flex;gap:8px;margin-top:12px}
    .small-btn{padding:8px 10px;border-radius:10px;border:none;cursor:pointer}
    .small-btn.edit{background:#28a745;color:white} /* green edit button */
    .small-btn.delete{background:#ff6b6b;color:white}
    footer{background:linear-gradient(135deg,#333,#555);color:white;padding:28px 0;margin-top:30px}
    .footer-content{max-width:1200px;margin:0 auto;padding:0 20px;display:flex;justify-content:space-between;align-items:center}
    @media(max-width:900px){.products-grid{grid-template-columns:repeat(2,1fr)}.form-grid{grid-template-columns:1fr}}
    @media(max-width:480px){.products-grid{grid-template-columns:1fr}}
    .center{text-align:center}
    .muted{color:#6c757d;font-size:13px}
    .controls{display:flex;gap:8px;align-items:center}
  </style>
</head>
<body>
  <header class="top-nav">
    <div class="logo" style="margin:auto">
      <img src="img/taze-logo.png" alt="Tazerwa logo">
    </div>
    <a class="home-btn" href="https://tazerwa.com" target="_blank" style="position:absolute;left:24px">Home</a>
  </header>

  <main class="container">
    <h1 class="center">Manage Products</h1>

    <!-- Filters -->
    <div class="filter-row">
      <select id="categorySelect" class="form-control">
        <option value="">Select category</option>
      </select>
      <select id="subcategorySelect" class="form-control" disabled>
        <option value="">Select subcategory</option>
      </select>
    </div>

    <!-- Add toggle -->
    <div class="add-toggle">
      <button id="toggleAdd" class="plus-btn" title="Add product">+</button>
    </div>
    <p class="center muted">Add a New Product</p>

    <!-- Add / Edit Form -->
    <div id="addForm" class="add-form">
      <form id="productForm">
        <div class="form-grid">
          <div class="form-row">
            <label for="pName">Product name</label>
            <input id="pName" class="form-control" required>
          </div>
          <div class="form-row">
            <label for="pPrice">Price (RWF)</label>
            <input id="pPrice" type="number" class="form-control" required>
          </div>
          <div class="form-row">
            <label for="pUnit">Unit</label>
            <input id="pUnit" class="form-control" placeholder="e.g., 1kg">
          </div>
          <div class="form-row">
            <label for="pImage">Image Upload</label>
            <input type="file" id="pImageFile" accept="image/*" class="form-control">
            <input id="pImage" class="form-control" placeholder="or paste URL">
          </div>
          <div class="form-row">
            <label for="pCategory">Category</label>
            <input id="pCategory" class="form-control" disabled>
          </div>
          <div class="form-row">
            <label for="pSubcategory">Subcategory</label>
            <input id="pSubcategory" class="form-control" disabled>
          </div>
        </div>
        <div style="margin-top:12px;text-align:center">
          <button id="saveProductBtn" class="btn btn-primary">Add product</button>
          <button id="cancelEdit" type="button" class="btn btn-outline" style="margin-left:8px">Cancel</button>
        </div>
      </form>
    </div>

    <!-- Results -->
    <section class="products-section">
      <div class="products-header">
        <h2 class="section-title">Results</h2>
        <p id="resultsCount" class="results-count muted">Select a category & subcategory to load products</p>
      </div>
      <div id="productsContainer" class="products-grid"></div>
    </section>
  </main>

  <footer>
    <div class="footer-content">
      <div>Tazerwa &copy; <span id="year"></span></div>
      <div class="muted">Admin interface — products auto-sync via backend</div>
    </div>
  </footer>

  <script>
    // ===============================
// Admin Panel JS
// ===============================

// Backend API endpoint
const API_URL = "http://localhost/Tazerwa/api.php";

// Global products array
let allProducts = [];

// Load all products from backend
async function loadProducts() {
  try {
    const res = await fetch(API_URL);
    allProducts = await res.json();
    displayProducts(allProducts);
  } catch (err) {
    console.error("Error loading products:", err);
  }
}

// Display products in grid
function displayProducts(products) {
  const container = document.getElementById("productsContainer");
  if (!container) return;

  container.innerHTML = "";

  if (products.length === 0) {
    container.innerHTML = "<p>No products found.</p>";
    return;
  }

  products.forEach(p => {
    const card = document.createElement("div");
    card.className = "product-card";

    card.innerHTML = `
      <div class="product-image">
        <img src="${p.image}" alt="${p.name}">
      </div>
      <div class="product-info">
        <h4 class="product-name">${p.name}</h4>
        <p class="product-price"><strong>${p.price} RWF</strong></p>
        <div class="product-actions">
          <button class="edit-btn" onclick="openEditModal(${p.id})">Edit</button>
          <button class="delete-btn" onclick="deleteProduct(${p.id})">Delete</button>
        </div>
      </div>
    `;

    container.appendChild(card);
  });
}

// ===============================
// Filtering & Searching
// ===============================
function filterProducts() {
  const search = document.getElementById("searchInput").value.toLowerCase();
  const category = document.getElementById("categorySelect").value;

  let filtered = allProducts.filter(p =>
    p.name.toLowerCase().includes(search) &&
    (category === "" || p.category === category)
  );

  displayProducts(filtered);
}

// ===============================
// Product Actions
// ===============================
function openEditModal(id) {
  const product = allProducts.find(p => p.id === id);
  if (!product) return;

  document.getElementById("editId").value = product.id;
  document.getElementById("editName").value = product.name;
  document.getElementById("editPrice").value = product.price;
  document.getElementById("editCategory").value = product.category;
  document.getElementById("editSubcategory").value = product.subcategory;

  document.getElementById("editModal").style.display = "block";
}

function closeEditModal() {
  document.getElementById("editModal").style.display = "none";
}

async function saveProduct() {
  const id = document.getElementById("editId").value;
  const name = document.getElementById("editName").value;
  const price = document.getElementById("editPrice").value;
  const category = document.getElementById("editCategory").value;
  const subcategory = document.getElementById("editSubcategory").value;

  const updatedProduct = { id, name, price, category, subcategory };

  try {
    await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action: "update", product: updatedProduct })
    });

    closeEditModal();
    loadProducts();
  } catch (err) {
    console.error("Error saving product:", err);
  }
}

async function deleteProduct(id) {
  if (!confirm("Are you sure you want to delete this product?")) return;

  try {
    await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action: "delete", id })
    });

    loadProducts();
  } catch (err) {
    console.error("Error deleting product:", err);
  }
}

// ===============================
// Add New Product
// ===============================
async function addNewProduct() {
  const name = document.getElementById("newName").value;
  const price = document.getElementById("newPrice").value;
  const category = document.getElementById("newCategory").value;
  const subcategory = document.getElementById("newSubcategory").value;
  const image = document.getElementById("newImage").files[0];

  if (!name || !price || !category) {
    alert("Please fill all required fields!");
    return;
  }

  const formData = new FormData();
  formData.append("action", "add");
  formData.append("name", name);
  formData.append("price", price);
  formData.append("category", category);
  formData.append("subcategory", subcategory);
  if (image) formData.append("image", image);

  try {
    await fetch(API_URL, {
      method: "POST",
      body: formData
    });

    loadProducts();
    document.getElementById("newProductForm").reset();
  } catch (err) {
    console.error("Error adding product:", err);
  }
}

// ===============================
// Event Listeners
// ===============================
document.getElementById("searchInput").addEventListener("input", filterProducts);
document.getElementById("categorySelect").addEventListener("change", filterProducts);

window.onload = loadProducts;

  </script>
</body>
</html>
